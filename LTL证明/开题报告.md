## 基于PVS的PPTLI定理证明系统的设计与实现



### 一、论文概况

#### 	选题来源:

国家自然科学基金项目

#### 	中文摘要:

时序逻辑作为一种能够描述程序性质的规格说明语言 ，被广泛的应用于形式验证中。但是目前我们只能用手工证明的方式对时序逻辑的相关性质进行验证。针对该问题，本文提出了一种基于定理证明器PVS ( prototype verification  system)的时序逻辑自动定理证明方法。该方法通过利用现有的定理证明器 PVS 对时序逻辑的语法和语义进行描述，使得原型验证系统能够正确识别时序逻辑公式。进一步使用原型验证系统的规范语言对时序逻辑的公理系统和待证定理进行描述，最后调用原型验证系统证明器的相关证明命令来实现对时序逻辑公式的推演证明。在证明的过程中，简单的细节将会被原型验证系统自动地证明，用户仅需要在关键的节点进行指导，从而实现对时序逻辑公式的半自动证明。这样定理的证明过程将得到简化。

### 二、选题依据

#### 选题意义

近年来，提高软件的可靠性与安全性日益成为紧迫的关键问题，得到学术界和工程界人员的共同关注。在国外，曾发生过因软件测试未发现的逻辑错误导制登月飞船发射失败的重大事故。1996年6月，Ariane 5运载火箭首次测试发射，但火箭在发射后37秒被迫自行引爆。经事故调查发现是一段继承Ariane 4的代码导致。该行代码需要将64位浮点数转化为16位整数，而64位浮点数代表的数值范围超过了16位整数的表达范围，最终产生溢出触发CPU错误捕获。在出错后，备用代码系统被启动，然而同样包含着该行代码，最终导致系统被锁死。更讽刺的是，该行代码对于Ariane 5来说是不必要的。传统的基于经验的软件工程方法有很大的局限性，为提高软件的可信度，各种基于形式化的方法被不断提出并用来描述和验证软件系统，其中比较常用的有4类符号系统，分别是：自动机、时序逻辑、Petri网、进程代数。

一般的时序逻辑被用于描述系统的规范，可以通过模型验证的方法或定理证明的方法来验证系统的规范具有哪些性质。投影时序逻辑PTL是区间时序逻辑ITL的扩展，同时支持有穷模型和无穷模型，并且引入了全新的两个投影操作符Projection和Projection—plus，与ITL相比较，PTL的投影操作符更加灵活，可以定义出Chop，Chop-Star以及ITL的投影操作符proj。由于一阶逻辑具有不可判定性，并不适合用来描述系统性质，这里我们一般采用简化的命题式的时序逻辑用于对各类软硬件系统的描述、建模和验证。带索引表达式的命题投影时序逻辑PPTLI( PPTL with Indexed expressions )中的索引表达式是通过无限多次地应用语法规则得到的，但它具有明确的语义和一定的良好性质。并且已经证明PPTLI 具有完全正则的表达能力，能够等价的表述LTL和PITL。因此 PPTLI是一种统一的时序逻辑，适用于描述和刻画计算机程序和系统的各类性质。

模型检测与定理证明是当前主流的两种形式化验证方法。模型检测建立在模型理论的基础上，验证时首先需要使用有穷状态转换系统对待验证系统建模，并结合时序逻辑公式描述系统期望的性质，最后通过算法遍历系统中的状态以检测性质是否成立。模型检测的最大优点是验证过程可通过模型检测器(如SPIN和SMV)自动完成，但缺点是受状态空间爆炸问题所限，不能适用于无穷状态系统。

自动定理证明是指把人类证明定理的过程变成能在计算机上自动实现符号演算的过程。它是典型的逻辑推理问题之一，在发展人工智能方法上起过重大作用。很多非数学领域的任务如医疗诊断、信息检索、规划制定和问题求解，都可以转换成一个定理证明问题。定理证明建立在证明理论之上，验证时首先提取系统的模型并表示为逻辑的命题、谓词、引理和定理等，待验证的性质表示为定理，然后在验证者的引导下，不断地对公理和已证明的定理应用推理规则来产生新的定理，直至推导出所需要的定理为止。定理证明对有穷及无穷的状态系统均可适用，但往往不能做到完全的自动证明，需要在关键节点上进行人为指明需要使用的逻辑规则和公式替换方法。在实际的系统验证中，往往需要将两种方法结合起来， 互相补充进行验证。

#### 国内外研究现状

自从以色列理论计算机科学家 Pnueli 于 1977 年 首先提出时序逻辑的概念，时序逻辑相关理论便得到急速的发展与扩充，经过30年的发展，时序逻辑已经成为包含线性时序逻辑(LTL)，计算树逻辑(CTL)，区间时序逻辑(ITL)和行为时序逻辑(TLA)等众多分支的学科，并在变换系统、交互式系统、并发系统的描述与验证的应用上取得了巨大成功。ITL作为时序逻辑的一个重要分支，包含Chop，Chop—star以及Projection(proj)等时序操作符，具备了比其他时序逻辑更强的表达能力。投影时序逻辑(PTL)在区间时序逻辑(ITL)的基础上进一步扩展，增加了更加灵活强大的投影操作符。更进一步PPTLI提出索引表达式的概念，具有完全正则的表达能力，是一种统一的时序逻辑。

自动定理证明是一种利用计算机完全或部分代替人工进行定理证明的方式 ．它克服了纯人工证明方法易出错、证明复杂等缺点 ，已成功应用于数学定理的证明以及处理器 、安全协议和程序验证中。主要包括两种方法 ：完全自动定理证明和交互式定理证明。完全自动定理证明虽然能够使用计算机完全代替人工进行 自动推理 ，但是表达能力较弱、适用范围有限 。典型的定理证明器有 ACL２、HOL 和 Otter 等 ；交互式定理证明，也称为半自动定理证明，具有表达能力强、灵活性高，能够自动地证明琐碎的细节等特点 ，但对于一些复杂的证明仍需要人工在关键的节点指导 。典型的定理证明器有 PVS 、Coq 和 Isabelle 等 。特别地 ，原型验证系统（Prototype Verification System ，PVS）是由斯坦福研究机构开发的 ，同Coq、HOL一样基于高阶逻辑，主要由 PVS 规范语言和 PVS 证明器组成 。同时PVS提供了丰富的类型系统和强大的推理策略，所以如果能用PVS语言对表达能力更强的时序逻辑加以描述，就可以用它来以交互的方式实现该逻辑的定理证明系统。

关于时序逻辑定理证明系统的实现，已经有不少人做过相关工作。Pnueli 等人实现了TLPVS，该系统基于参数化公平系统(parameterized fair system PFS) , 在PVS中建立了线性时序逻辑模型，是一个比较成熟、较为庞大的系统。 Rajan 等人基于PVS将模型检验和证明检验的互补技术结合起来，对CTL和fair CTL的相关性质进行描述与实现。类似的工作还有Sprenger 基于Coq定理证明器，以模型检测与定理证明相结合的方式对模态逻辑中的μ演算进行了形式化验证。Cini 等人 基于RV（Runtime Verification）验证技术，对线性时序逻辑进行验证。作为可扩展的程序验证方法，有效减轻了模型检测中状态爆炸的问题。许庆国 等人基于PVS对时序逻辑进行语义模型和实现，该系统不区分线性和计算树逻辑 , 是一种更为泛化的逻辑模型。胡成军等人用Gentzen风格的相继式演算，开发了一套区间逻辑的辅助定理证明工具DC/P，基于DC/P能够实现ITL的半自动定理证明。

目前为止，大部分对于时序逻辑的定理证明系统都是以线性时序逻辑或者区间时序逻辑进行设计，表达能力稍显不足。同时基于语义的实现往往会使得证明过程中引入大量的语义操作符，使得证明过程繁琐。本工作针对以上问题，通过结合PPTLI中的投影算子与索引表达式相关概念，基于PVS设计并实现一套表达能力更强的公理系统。  同时基于语法层次，着重于对公理系统进行语法上的描述，以实现PPTLI的半自动定理证明。

### 三、研究方案

#### 研究目标

通过对时序逻辑的相关性质进行描述，结合已有的定理证明工具，设计一套表达能力更强，符合规范的可靠完备的公理系统。以实现相关时序逻辑公式的半自动定理证明。

#### 研究内容

为实现上述目标，本文基于PVS定理证明工具，对PPTLI的语法模型进行相关描述，具体包括以下几点：

+ 基于对已有理论证明系统的改进，设计一套适用于PVS的PPTLI证明系统
+ 通过PVS语言对PPTLI公理和推理规则进行实现
+ 探索有意义的定理实例，并使用系统进行证明 
+ 开发对用户友好的系统界面

#### 拟解决的关键问题       

+ 如何把永真推理规则、命题重言式规则和索引表达式相关规则转换为适用于PVS实现的规则形式
+ 如何提供一种良好的 、适用于用户与PVS交互的界面   

#### **拟采取的研究方法、技术路线、实验方案及可行性研究** 

##### 研究方法

通过查阅文献，对基本的线性时序逻辑、区间时序逻辑进行理论学习，通过对应公理系统尝试手动证明相关定理。

对时序逻辑理论进一步学习，熟悉投影时序逻辑的公理系统、PPTLI的公理系统

通过学习PVS官方教程，掌握PVS的使用

##### 技术路线   

关于时序逻辑的相关性质，拟采用原型验证系统PVS进行描述。一方面PVS基于高阶逻辑，具有丰富的类型系统，底层实现了命题逻辑、谓词逻辑的证明系统，用户可以自定义规则和证明策略，具有很强的表达能力。另一方面PVS以交互方式工作，同时又具备高度的自动化能力。这使得PVS具有很强的证明能力，琐屑的证明细节为证明器内部推理机制所掩盖，使得用户仅在关键决策点上控制证明过程。

PPTLI作为表达能力更强，统一的时序逻辑，有两套相关的公理和推理规则。对PPTLI定理证明系统的设计从结构出发，由上至下依次进行。最后完整的证明系统由时序算子的定义部分、公理系统的设计与实现部分、相关定理的证明部分组合而成。具体的技术路线如下：

+ 基于对已有理论证明系统的改进，设计一套适用于PVS的PPTLI证明系统

  + 通过PVS  对PPTLI基本时序算子进行良类型的定义
  + 通过基本时序算子定义其他扩展算子（语法糖）

  + 重点设计索引表达式的操作算子（无穷或）以及对应的三种形式  
  + 规定时序算子的优先级  简化公式
  
+ 通过PVS语言对PPTLI公理和推理规则进行实现

  + 结合PVS对PPTLI中两套公理和对应的推理规则，分别进行设计。使得其同时符合PPTLI和PVS语法。主要考虑基于语法设计。关于公理系统（axiom）的设计，重点考虑多参数、具有复杂形式的公理的定义描述。结合PVS内置的类型进行实现，同时尽量在证明过程中使用到PVS中内嵌的命题逻辑的语法证明规则。
  + 在对推理规则的设计中，需要设计一套符合永真推理规则 ，能够对重言式进行有效识别的相继式演算，同时与PVS的证明策略不冲突。
  
+ 探索有意义的定理实例，并使用系统进行证明 

  + 查阅文献，探索相关的PPTLI的定理，根据需要同时将其转化为PVS能够识别的形式，以lemma标记。

  + 在对定理进行验证的过程中，需要人为引入合适的公理、重言式，以及对公式的部分替换。这也是证明过程中比较困难的部分。
  + 证明过程需要兼容命题逻辑中的语法
  + 证明过程中产生的其他简单的子目标可以使用PVS的高阶命令进行自动证明。
  
+ 开发对用户友好的系统界面 

  + 提供用户能够访问PVS的界面进行交互

  + 实现用户能够自由选择对已有的lemma的证明的功能
  
  + 实现用户能够自己创建lemma并证明的功能
  + 证明过程中能够友好的提示用户需要使用哪种定理、重言式
  

##### 实验方案 

+ 查阅文献，学习时序逻辑方面的基础理论
+ 熟悉PVS基本语法
+ 通过PVS对LTL、ITL、PTL、带有索引表达式的PPTLI进行描述

##### 可行性分析

+ 论文《Propositional Temporal Logics: Decidability and Completeness》提出PTL理论，并且介绍了对应的公理系统和推理规则，并手动对相关定理进行了证明。

+ 论文《TLPVS: A pvs-Based LTL Verification System》基于参数化公平系统，建立了LTL模型：TLPVS。

  

#### 研究计划及预期取得的研究成果

| 时间节点        | 预期研究成果                                     |
| --------------- | ------------------------------------------------ |
| 2021.03-2021.05 | 学习PVS的基本使用                                |
| 2021.05-2021.06 | 了解基本投影时序逻辑PTL、带有索引表达式的PPTL    |
| 2021.06-2021.08 | 认识时序逻辑的公理系统、推导规则，手动证明       |
| 2021.08-2021-11 | 通过PVS 对基本时序逻辑进行语法上的描述           |
| 2021.11-2022.02 | 通过PVS 对PPTL(带索引表达式)进行语法上的描述     |
| 2022.02-2022.04 | 完善PPTL的公理系统、进行测试、提供良好的交互界面 |
| 2022.04-2022.05 | 撰写论文                                         |



### 四、研究基础

#### 已具备的实验条件和研究工作积累

+ 实验条件

  PVS 6.0（虚拟机 Ubuntu 18.04）  

+ 研究工作积累

  实验室有一套完整的PTL模型、对带有索引表达式的PPTLI基本了解、对LTL、ITL相关语法语义、公理系统以及推导规则比较熟悉。

#### 已取得的科研成果

无

